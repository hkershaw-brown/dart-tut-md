
---

# DART Tutorial Section 21:  
### Observation Types and Observing System Design  

---

### DART Assimilations Controlled by Observation Sequence Files

- Observation sequence files contain a time-ordered list of observations stored as a ‘linked list.’
- DART filter continues to assimilate until it runs out of observations.
- This process is the same for synthetic observation generation using `perfect_model_obs`.

---

### Observation Type Details

Each observation has several components, including:
1. **Unique Key**: An identifier for the observation type.
2. **Values**: Observation values, which can include location, time, and error variance.
3. **Quality Control (QC) Fields**: Fields used for quality control checks.

---

### Defining Observations

- Observations have specific types (e.g., radiosonde temperature) and are associated with generic quantities like **QTY_TEMPERATURE**.
- Each observation type is indexed in the **obs_type_info** table in the `obs_kind_mod`.
- Observation definitions include the location, observation type, time, and error variance.

---

### Observation Generic Quantities and Specific Types

- Multiple observation types can share a generic quantity. For example:
  - **RADIOSONDE_TEMPERATURE** and **ACARS_TEMPERATURE** both share the generic quantity **QTY_TEMPERATURE**.
- Model state variables are also associated with generic quantities, allowing models like CAM and WRF to use the same interpolation field for various observation types.

---

### Implementing Observation Definitions in DART

Observation definitions are implemented in Fortran 90 files (`obs_def_xxx_mod.f90`). This involves:
1. **Defining the observation type** and associating it with a generic quantity.
2. Optionally, additional metadata or custom forward operator code may be required if the observation type needs specialized handling.

If the forward operator does not require extra handling, the DART preprocess program can generate all required code using the `COMMON_CODE` keyword.

---

### Implementing Customized Observation Definitions

For customized observation types that require extra information or specialized forward operators, six special sections must be included in the `obs_def_mod.f90` file:
1. **Kind List**: Defines the observation types and generic quantities.
2. **Use Statements**: Declares any special modules required for the observation type.
3. **Case for Expected Observations**: Specifies how to compute the expected observation value.
4. **Case for Reading Extra Info**: Reads additional information from an observation sequence file.
5. **Case for Writing Extra Info**: Writes extra information to an observation sequence file.
6. **Interactive Creation**: Allows the creation of observation-specific metadata interactively.

---

### Examples of Frequently Used obs_def Modules

DART includes various pre-defined `obs_def` modules for common observation types:
- **obs_def_reanalysis_bufr_mod.f90**: Handles observations from BUFR files.
- **obs_def_radar_mod.f90**: Provides forward operator code for radar reflectivity and radial velocity.
- **obs_def_gps_mod.f90**: Includes forward operators for GPS refractivity observations.
- **obs_def_ocean_mod.f90**: Supports observation types from the World Ocean Database.

---

### Using Custom Observation Definitions in DART

To use custom observation definitions:
1. Compile and run the preprocess program, specifying paths to all necessary `obs_def` modules in `&preprocess_nml`.
2. Compile other required program units, including the `obs_def_mod.f90` file generated by the preprocess step.
3. Select observation types to be assimilated or evaluated in `&obs_kind_nml`.

---

### Forward Operators and Modularity

Keeping models and observation definitions modular is challenging. Ideally:
- Models should handle spatial interpolation of state variables.
- Forward operators in `obs_def` modules should not expect more than this.

This modular approach ensures flexibility, although more complex models may require special handling for efficiency.

---

### DART Tutorial Index

1. Filtering for a One Variable System
2. The DART Directory Tree
3. DART Runtime Control and Documentation
4. How Observations Impact Unobserved State Variables
5. Comprehensive Filtering Theory
6. Other Updates for an Observed Variable
7. Some Additional Low-Order Models
8. Dealing with Sampling Error
9. More on Dealing with Error: Inflation
10. Regression and Nonlinear Effects
11. Creating DART Executables
12. Adaptive Inflation
13. Hierarchical Group Filters and Localization
14. Quality Control
15. DART Experiments: Control and Design
16. Diagnostic Output
17. Creating Observation Sequences
18. Lost in Phase Space: The Challenge of Not Knowing the Truth
19. DART-Compliant Models and Making Models Compliant
20. Model Parameter Estimation
21. **Observation Types and Observing System Design**

---

